<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scrollytelling Timeline (Full-screen BG, Mobile-safe)</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body { margin:0; font-family:"Noto Sans Bengali", system-ui, sans-serif; background:#000; }

    /* Sticky timeline header */
    .timeline-sticky{
      position: sticky; top: 0; z-index: 50;
      background:#fff;
      border-bottom: 1px solid #eee;
      padding: 14px 16px 10px;
    }
    .topline{ display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap; }
    .title{ font-weight: 800; }

    .timeline-wrap{
      position: relative;
      height: 86px;
      margin-top: 10px;
      touch-action: pan-y;
      user-select: none;
    }
    .track{
      position:absolute; left:0; right:0; top:28px;
      height:6px; border-radius:999px; background:#eee;
      cursor: pointer;
    }
    .progress{
      position:absolute; left:0; top:28px;
      height:6px; border-radius:999px; background:#111;
      width:0%;
      transition: width 140ms linear;
      pointer-events:none;
    }
    .playhead{
      position:absolute; top:18px; left:0%;
      width:18px; height:18px; border-radius:50%;
      background:#111; transform:translateX(-50%);
      transition:left 140ms linear;
      cursor: grab;
      touch-action: none;
    }
    .playhead:active{ cursor: grabbing; }

    /* Tick marks */
    .ticks{ position:absolute; left:0; right:0; top:20px; height:24px; }
    .tick{
      position:absolute; top:0;
      width: 18px; height: 24px; /* bigger hit area */
      transform: translateX(-50%);
      display:flex; align-items:flex-end; justify-content:center;
      cursor:pointer;
    }
    .tick::before{
      content:"";
      width:2px; height:14px; border-radius:2px; background:#bbb;
    }
    .tick.is-active::before{ background:#111; height:18px; }

    .activeTimeCenter{
      position:absolute; left:50%; top:52px; transform:translateX(-50%);
      font-size: 13px; color:#444; font-weight:600; white-space:nowrap;
      pointer-events:none;
    }

    .labels{ margin-top: 8px; display:flex; justify-content:space-between; font-size:12px; color:#666; }

    /* ===== Background stage (mobile-safe viewport units) ===== */
    .bgStage{
      position: sticky;
      top: 108px;                 /* below header */
      height: calc(100svh - 126px); /* stable on mobile (prevents top black gap) */
      z-index: 1;
      overflow: hidden;
      background:#000;
    }
    @supports not (height: 100svh){
      .bgStage{ height: calc(100vh - 126px); }
    }

    /* ===== Cross-fade background layers (FULLSCREEN via cover) ===== */
    .bgLayer{
      position:absolute; inset:0;
      background-size: cover;              /* <-- IMPORTANT: fills screen */
      background-position: center center;  /* consistent crop */
      background-repeat: no-repeat;
      background-color:#000;

      will-change: opacity;
      transition: opacity 520ms ease;
      opacity: 0;
    }
    .bgLayer.is-visible{ opacity: 1; }

    .bgOverlay{
      position:absolute; inset:0;
      background: linear-gradient(
        to bottom,
        rgba(0,0,0,.18) 0%,
        rgba(0,0,0,.40) 45%,
        rgba(0,0,0,.66) 100%
      );
      z-index: 3;
      pointer-events:none;
    }

    /* Steps layer */
    .scrolly{
      position: relative;
      z-index: 10;
      max-width: 1200px;
      margin: 0 auto;
      padding: 18px 16px 90px;
    }

    .step{
      min-height: 110vh;
      display:flex;
      align-items:flex-end;
      position: relative;
    }

    /* Left card */
    .card{
      position: sticky;
      bottom: 22px;
      width: 360px;
      max-width: calc(100% - 32px);
      margin-right: auto;

      background: rgba(240,240,240,.80);
      border: 1px solid rgba(255,255,255,.55);
      border-radius: 18px;
      padding: 14px 14px 16px;
      box-shadow: 0 14px 36px rgba(0,0,0,.30);
      backdrop-filter: blur(7px);

      opacity: 0;
      transform: translateY(22px);
      transition: opacity 280ms ease, transform 280ms ease;
      will-change: opacity, transform;

      max-height: 55vh;
      overflow-y: auto;
    }

    .step.is-active .card{
      opacity: 1;
      transform: translateY(0);
    }

    .when{ font-size: 12px; color:#111; opacity:.75; margin-bottom: 6px; }
    .card h3{ margin:0 0 8px 0; font-size: 20px; font-weight: 800; color:#111; }
    .card p{ margin:0; line-height: 1.7; font-size: 14px; color:#222; }

    @media (max-width: 900px){
      .bgStage{ top: 92px; }      /* header is shorter on mobile */
      .step{ min-height: 135vh; } /* more scroll distance */
      .card{ width: 320px; bottom: 16px; }
    }
    @media (max-width: 420px){
      .card{ width: calc(100% - 20px); }
    }
  </style>
</head>

<body>
  <header class="timeline-sticky">
    <div class="topline">
      <div class="title">ঢাকা: সংবাদপত্র অফিসে হামলা — স্ক্রল টাইমলাইন</div>
    </div>

    <div class="timeline-wrap" id="timelineWrap">
      <div class="track" id="track" aria-label="Timeline track"></div>
      <div class="progress" id="progress"></div>
      <div class="playhead" id="playhead" role="slider" aria-label="Timeline playhead"
           aria-valuemin="0" aria-valuemax="11" aria-valuenow="0" tabindex="0"></div>
      <div class="ticks" id="ticks"></div>
      <div class="activeTimeCenter" id="activeTime">সময়: —</div>
    </div>

    <div class="labels">
      <span>১৮ ডিসেম্বর ১০:০০ PM</span>
      <span>১৯ ডিসেম্বর ০৬:০০ PM</span>
    </div>
  </header>

  <div class="bgStage" aria-hidden="true">
    <div class="bgLayer is-visible" id="bgA"></div>
    <div class="bgLayer" id="bgB"></div>
    <div class="bgOverlay"></div>
  </div>

  <main class="scrolly">
    <section id="steps"></section>
  </main>

  <script src="https://unpkg.com/scrollama"></script>
  <script>
    if ("scrollRestoration" in history) history.scrollRestoration = "manual";
    window.addEventListener("load", () => window.scrollTo(0, 0));

    // ===== DATA (edit these) =====
    // Use your *_master.jpg images here
    const SCENES = [
      { id:"s1",  progress:0/11,  timeLabel:"১৮ ডিসেম্বর ১০:০২ PM", titleBn:"শিরোনাম ১",
        longText:"এখানে আপনার বিস্তারিত টেক্সট থাকবে (স্টেপ ১)।",
        image:"assets/scene1.jpg"
      },
      { id:"s2",  progress:1/11,  timeLabel:"১৮ ডিসেম্বর ১০:২০ PM", titleBn:"শিরোনাম ২",
        longText:"এখানে আপনার বিস্তারিত টেক্সট থাকবে (স্টেপ ২)।",
        image:"assets/scene2.jpg"
      },
      { id:"s3",  progress:2/11,  timeLabel:"১৮ ডিসেম্বর ১০:৪০ PM", titleBn:"শিরোনাম ৩",
        longText:"এখানে আপনার বিস্তারিত টেক্সট থাকবে (স্টেপ ৩)।",
        image:"assets/scene3.jpg"
      },
      { id:"s4",  progress:3/11,  timeLabel:"১৮ ডিসেম্বর ১১:০৫ PM", titleBn:"শিরোনাম ৪",
        longText:"এখানে আপনার বিস্তারিত টেক্সট থাকবে (স্টেপ ৪)।",
        image:"assets/scene4.jpg"
      },
      { id:"s5",  progress:4/11,  timeLabel:"১৮ ডিসেম্বর ১১:৩০ PM", titleBn:"শিরোনাম ৫",
        longText:"এখানে আপনার বিস্তারিত টেক্সট থাকবে (স্টেপ ৫)।",
        image:"assets/scene5.jpg"
      },
      { id:"s6",  progress:5/11,  timeLabel:"১৮ ডিসেম্বর ১১:৪৫ PM", titleBn:"শিরোনাম ৬",
        longText:"এখানে আপনার বিস্তারিত টেক্সট থাকবে (স্টেপ ৬)।",
        image:"assets/scene6.jpg"
      },
      { id:"s7",  progress:6/11,  timeLabel:"১৯ ডিসেম্বর ১২:৩০ AM", titleBn:"শিরোনাম ৭",
        longText:"এখানে আপনার বিস্তারিত টেক্সট থাকবে (স্টেপ ৭)।",
        image:"assets/scene7.jpg"
      },
      { id:"s8",  progress:7/11,  timeLabel:"১৯ ডিসেম্বর ০২:১৫ AM", titleBn:"শিরোনাম ৮",
        longText:"এখানে আপনার বিস্তারিত টেক্সট থাকবে (স্টেপ ৮)।",
        image:"assets/scene8.jpg"
      },
      { id:"s9",  progress:8/11,  timeLabel:"১৯ ডিসেম্বর ০৭:৩০ AM", titleBn:"শিরোনাম ৯",
        longText:"এখানে আপনার বিস্তারিত টেক্সট থাকবে (স্টেপ ৯)।",
        image:"assets/scene9.jpg"
      },
      { id:"s10", progress:9/11,  timeLabel:"১৯ ডিসেম্বর ০৯:৩০ AM", titleBn:"শিরোনাম ১০",
        longText:"এখানে আপনার বিস্তারিত টেক্সট থাকবে (স্টেপ ১০)।",
        image:"assets/scene10.jpg"
      },
      { id:"s11", progress:10/11, timeLabel:"১৯ ডিসেম্বর ০১:৪৫ PM", titleBn:"শিরোনাম ১১",
        longText:"এখানে আপনার বিস্তারিত টেক্সট থাকবে (স্টেপ ১১)।",
        image:"assets/scene11.jpg"
      },
      { id:"s12", progress:11/11, timeLabel:"১৯ ডিসেম্বর ০৬:০০ PM", titleBn:"শিরোনাম ১২",
        longText:"এখানে আপনার বিস্তারিত টেক্সট থাকবে (স্টেপ ১২)।",
        image:"assets/scene12.jpg"
      }
    ];

    // ===== BUILD STEPS =====
    const stepsRoot = document.getElementById("steps");
    SCENES.forEach((s, idx) => {
      const el = document.createElement("div");
      el.className = "step";
      el.dataset.index = idx;
      el.innerHTML = `
        <div class="card">
          <div class="when">${s.timeLabel}</div>
          <h3>${s.titleBn}</h3>
          <p>${escapeHtml(s.longText)}</p>
        </div>
      `;
      stepsRoot.appendChild(el);
    });

    // ===== TICKS =====
    const ticksRoot = document.getElementById("ticks");
    const tickEls = [];
    SCENES.forEach((s, idx) => {
      const t = document.createElement("div");
      t.className = "tick";
      t.style.left = (Math.max(0, Math.min(1, s.progress)) * 100) + "%";
      t.dataset.index = idx;
      t.title = s.timeLabel;
      t.addEventListener("click", () => scrollToStep(idx));
      ticksRoot.appendChild(t);
      tickEls.push(t);
    });

    // ===== Timeline UI =====
    const timelineWrap = document.getElementById("timelineWrap");
    const track = document.getElementById("track");
    const playhead = document.getElementById("playhead");
    const progressBar = document.getElementById("progress");
    const activeTime = document.getElementById("activeTime");

    // ===== BG crossfade =====
    const bgA = document.getElementById("bgA");
    const bgB = document.getElementById("bgB");
    let front = bgA, back = bgB;
    let currentIdx = -1;

    function crossFadeTo(url){
      back.style.backgroundImage = `url("${url}")`;
      back.classList.add("is-visible");
      front.classList.remove("is-visible");
      const tmp = front; front = back; back = tmp;
    }

    function clamp01(x){ return Math.max(0, Math.min(1, x)); }

    function setTimelineUI(idx){
      const s = SCENES[idx];
      const pct = clamp01(s.progress) * 100;
      playhead.style.left = pct + "%";
      progressBar.style.width = pct + "%";
      tickEls.forEach(x => x.classList.remove("is-active"));
      tickEls[idx]?.classList.add("is-active");
      activeTime.textContent = "সময়: " + (s.timeLabel || "—");
      playhead.setAttribute("aria-valuenow", String(idx));
    }

    function renderScene(idx){
      const s = SCENES[idx];

      if (idx !== currentIdx) {
        if (currentIdx === -1) {
          front.style.backgroundImage = `url("${s.image}")`;
          front.classList.add("is-visible");
        } else {
          crossFadeTo(s.image);
        }
        currentIdx = idx;
      }

      setTimelineUI(idx);
    }

    // ===== Card fade timing (EDIT HERE) =====
    function setCardProgress(stepEl, progress){
      const card = stepEl.querySelector(".card");
      if (!card) return;

      const hold = 0.78;      // visible until 78% of the step
      const fadeSpan = 0.28;  // fade between 78%..~100%

      let alpha = 1;
      if (progress > hold) {
        const t = Math.min(1, (progress - hold) / fadeSpan);
        alpha = 1 - t;
      }
      alpha = Math.max(0.06, alpha);

      card.style.opacity = String(alpha);
      card.style.transform = `translateY(${(1 - alpha) * -14}px)`;
    }

    // ===== Scrollama =====
    const scroller = scrollama();
    scroller.setup({ step: ".step", offset: 0.6, progress: true })
      .onStepEnter(({ element, index }) => {
        document.querySelectorAll(".step").forEach(x => x.classList.remove("is-active"));
        element.classList.add("is-active");
        renderScene(index);
        setCardProgress(element, 0);
      })
      .onStepProgress(({ element, progress }) => setCardProgress(element, progress))
      .onStepExit(({ element }) => {
        const card = element.querySelector(".card");
        if (card) { card.style.opacity = ""; card.style.transform = ""; }
      });

    // ===== Click/Drag timeline =====
    let isDragging = false;
    let dragRaf = 0;

    function getPctFromClientX(clientX){
      const r = timelineWrap.getBoundingClientRect();
      return clamp01((clientX - r.left) / r.width);
    }
    function idxFromPct(pct){
      return Math.round(pct * (SCENES.length - 1));
    }

    function scrollToStep(idx){
      const stepEl = document.querySelector(`.step[data-index="${idx}"]`);
      if (!stepEl) return;
      stepEl.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    function seekByClientX(clientX){
      const pct = getPctFromClientX(clientX);
      const idx = idxFromPct(pct);
      setTimelineUI(idx);
      scrollToStep(idx);
    }

    track.addEventListener("pointerdown", (e) => {
      track.setPointerCapture(e.pointerId);
      seekByClientX(e.clientX);
    });

    playhead.addEventListener("pointerdown", (e) => {
      isDragging = true;
      playhead.setPointerCapture(e.pointerId);
      playhead.style.transition = "none";
      progressBar.style.transition = "none";
      e.preventDefault();
    });

    playhead.addEventListener("pointermove", (e) => {
      if (!isDragging) return;
      const pct = getPctFromClientX(e.clientX);
      const idx = idxFromPct(pct);

      if (dragRaf) cancelAnimationFrame(dragRaf);
      dragRaf = requestAnimationFrame(() => setTimelineUI(idx));
    });

    playhead.addEventListener("pointerup", (e) => {
      if (!isDragging) return;
      isDragging = false;
      playhead.releasePointerCapture(e.pointerId);
      playhead.style.transition = "";
      progressBar.style.transition = "";
      const pct = getPctFromClientX(e.clientX);
      scrollToStep(idxFromPct(pct));
    });
    playhead.addEventListener("pointercancel", () => { isDragging = false; });

    playhead.addEventListener("keydown", (e) => {
      const active = Number(playhead.getAttribute("aria-valuenow") || "0");
      if (e.key === "ArrowRight") { e.preventDefault(); scrollToStep(Math.min(SCENES.length-1, active+1)); }
      if (e.key === "ArrowLeft")  { e.preventDefault(); scrollToStep(Math.max(0, active-1)); }
    });

    // Initial
    renderScene(0);
    document.querySelector(".step")?.classList.add("is-active");

    function onResize(){ scroller.resize(); }
    window.addEventListener("resize", onResize);
    window.addEventListener("orientationchange", onResize);
    setTimeout(onResize, 80);
    setTimeout(onResize, 350);

    function escapeHtml(str){
      return String(str ?? "").replace(/[&<>"']/g, ch => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[ch]));
    }
  </script>
</body>
</html>
